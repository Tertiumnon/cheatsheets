# Nginx Configuration for Angular Applications

This document provides a basic Nginx configuration to serve a production-built Angular application.

## 1. Build Your Angular Application

First, build your Angular application for production. This command typically creates a `dist/{your-app-name}/browser` directory (or just `dist/{your-app-name}/` in older Angular versions, or simply `dist/` if `outputPath` in `angular.json` is customized) containing the static files (HTML, CSS, JS, assets).

Navigate to your Angular project's root directory and run:

```bash
ng build --configuration production
# or simply 'ng build' if your production configuration is default
```

The output path is defined in your `angular.json` file (e.g., `projects.{your-app-name}.architect.build.options.outputPath`). Let's assume it's `dist/{your-app-name}/browser`.

## 2. Nginx Server Block Configuration

Nginx will serve the static files generated by the Angular build. A key aspect is configuring it to serve `index.html` for any routes that don't match a static file, which is necessary for Angular's client-side routing to work correctly.

Create a new Nginx site configuration file, for example, `/etc/nginx/sites-available/{your_angular_app_conf}`:

```nginx
// filepath: /etc/nginx/sites-available/{your_angular_app_conf}
server {
    listen 80;
    listen [::]:80; # For IPv6

    server_name {your_domain.com} www.{your_domain.com}; # Or your server's IP address

    # Path to your Angular app's build output
    # Adjust this path to where your 'ng build' output (index.html, main.js, etc.) is located.
    root /var/www/{your_angular_app_directory}/dist/{your-app-name}/browser;
    # Example: root /var/www/my-angular-app/dist/my-angular-app-name/browser;
    # Or if output is just dist/: root /var/www/my-angular-app/dist;

    # Default file to serve
    index index.html index.htm;

    # This is the crucial part for Angular routing:
    # Always serve index.html for any path that doesn't match a static file.
    location / {
        try_files $uri $uri/ /index.html;
    }

    # Optional: Add caching headers for static assets to improve performance
    location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|svg|woff|woff2|ttf|eot)$ {
        expires 7d; # Cache these assets for 7 days
        add_header Cache-Control "public";
        access_log off; # Optional: disable access logging for static assets
    }

    # Optional: Enable Gzip compression for text-based assets
    # Ensure gzip is enabled in your main nginx.conf (gzip on;)
    # gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript image/svg+xml;

    # Optional: Logging
    access_log /var/log/nginx/{your_angular_app_conf}.access.log;
    error_log /var/log/nginx/{your_angular_app_conf}.error.log;

    # Optional: Deny access to hidden files
    location ~ /\. {
        deny all;
    }
}

# For HTTPS (Recommended for production):
# server {
#     listen 443 ssl http2;
#     listen [::]:443 ssl http2; # For IPv6
#
#     server_name {your_domain.com} www.{your_domain.com};
#
#     root /var/www/{your_angular_app_directory}/dist/{your-app-name}/browser; # Same root as HTTP
#     index index.html index.htm;
#
#     # SSL Certificate paths (e.g., from Let's Encrypt)
#     ssl_certificate /etc/letsencrypt/live/{your_domain.com}/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/{your_domain.com}/privkey.pem;
#     include /etc/letsencrypt/options-ssl-nginx.conf; # Recommended SSL settings
#     ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;   # Recommended DH params
#
#     # Optional: Logging
#     access_log /var/log/nginx/{your_angular_app_conf}.ssl.access.log;
#     error_log /var/log/nginx/{your_angular_app_conf}.ssl.error.log;
#
#     location / {
#         try_files $uri $uri/ /index.html;
#     }
#
#     location ~* \.(?:css|js|jpg|jpeg|gif|png|ico|svg|woff|woff2|ttf|eot)$ {
#         expires 7d;
#         add_header Cache-Control "public";
#         access_log off;
#     }
#
#     # Redirect HTTP to HTTPS (place this in your port 80 server block if you use HTTPS)
#     # if ($scheme != "https") {
#     #    return 301 https://$host$request_uri;
#     # }
# }
```

*Replace placeholders like `{your_domain.com}`, `{your_angular_app_directory}`, `{your-app-name}`, and `{your_angular_app_conf}` with your actual values.*
*The `root` directive path is critical. It must point to the directory containing your Angular application's `index.html` and other built assets.*

## 3. Deploy Angular Files

Copy the contents of your Angular application's build output directory (e.g., `dist/{your-app-name}/browser/*`) to the `root` directory specified in your Nginx configuration (e.g., `/var/www/{your_angular_app_directory}/dist/{your-app-name}/browser/`).

Example:

```bash
# Assuming your Angular project is at /home/user/my-angular-project
# and your Nginx root is /var/www/my-angular-site
sudo mkdir -p /var/www/my-angular-site
sudo cp -r /home/user/my-angular-project/dist/{your-app-name}/browser/* /var/www/my-angular-site/
# Ensure Nginx has permissions to read these files
sudo chown -R www-data:www-data /var/www/my-angular-site # User might be 'nginx' depending on distro
sudo chmod -R 755 /var/www/my-angular-site
```

## 4. Enable the Nginx Site

Create a symbolic link from `sites-available` to `sites-enabled`:

```bash
sudo ln -s /etc/nginx/sites-available/{your_angular_app_conf} /etc/nginx/sites-enabled/
```

*If you have a default site configuration enabled (`/etc/nginx/sites-enabled/default`) and it conflicts, you might want to remove its symlink.*

## 5. Test and Reload Nginx

Always test your Nginx configuration before applying changes:

```bash
sudo nginx -t
```

If the test is successful, reload Nginx:

```bash
sudo systemctl reload nginx
```

## Key Considerations

- **`try_files`:** The `try_files $uri $uri/ /index.html;` directive is essential for Angular's client-side routing. It tells Nginx to first try to serve the requested URI as a file (`$uri`), then as a directory (`$uri/`), and if neither exists, fall back to serving `/index.html`. Angular then handles the routing internally.
- **Base Href:** If your Angular application is served from a subdirectory (e.g., `yourdomain.com/my-app/`), ensure you've set the `--base-href` option correctly during the `ng build` command (e.g., `ng build --base-href /my-app/`) and adjust your Nginx `location` block accordingly.
- **HTTPS:** For production, always configure HTTPS. You can use Let's Encrypt for free SSL certificates.
- **Caching:** Configure appropriate caching headers for your static assets to improve performance and reduce server load.
- **Gzip:** Enable Gzip compression in Nginx to reduce the size of transferred assets.
- **Permissions:** Ensure the Nginx worker process user (e.g., `www-data` on Debian/Ubuntu, `nginx` on CentOS/Fedora) has read access to your Angular application's files.
